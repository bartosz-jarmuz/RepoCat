@using RepoCat.Portal.Areas.Catalog.Models
@model RepoCat.Portal.Areas.Catalog.Models.BrowseRepositoryViewModel

@{
    ViewData["Title"] = "Repository overview";
    string cardClass = "card text-white bg-info";
}

@if (!@Model.ProjectsTable.Projects.Any())
{

    <div class="row">
        <div class="col-md-6 offset-3">
            <div class="text-center">

                <h2 class="text-dark">Sorry, nothing to show in '@Model.RepositoryName'</h2>
                <img src="~/images/cats/cat_hungry256.png" class="mx-auto d-block" alt="No results">
                <br />
                <span class="text-dark">The repository looks empty</span>
            </div>
        </div>
    </div>
}
else
{
    <span class="small " style="color: #73818f; margin-top: -15px !important;position: absolute;">
        Repository name:
    </span>
    <div class="h2" style="margin-top: 0px;">
        @Model.RepositoryName
    </div>


    <div class="row">
        <div class="col-sm-6 col-md-2">
            <div class="@cardClass" data-toggle="tooltip" title="The number of projects in this repository">
                <div class="card-body">
                    <div class="h1 text-muted text-right mb-4">
                        <i class="fas fa-file-code"></i>
                    </div>
                    <div class="text-value">@Model.NumberOfProjects</div>
                    <small class="text-muted text-uppercase font-weight-bold">Projects</small>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-2">
            <div class="@cardClass" data-toggle="tooltip" title="The number of projects in this repository
for which the data was not prepared by a human, but rather by a automatic tool.">
                <div class="card-body">
                    <div class="h1 text-muted text-right mb-4">
                        <i class="far fa-file-code"></i>
                    </div>
                    <div class="text-value">@Model.NumberOfAutogeneratedProjects</div>
                    <small class="text-muted text-uppercase font-weight-bold">Autogenerated projects</small>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-2">
            <div class="@cardClass">
                <div class="card-body">
                    <div class="h1 text-muted text-right mb-4">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="text-value">@Model.NumberOfTags</div>
                    <small class="text-muted text-uppercase font-weight-bold">Tags</small>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-2">
            <div class="@cardClass">
                <div class="card-body">
                    <div class="h1 text-muted text-right mb-4">
                        <i class="icon-calendar"></i>
                    </div>
                    <div class="text-value">@Model.ImportedDate</div>
                    <small class="text-muted text-uppercase font-weight-bold">Imported date</small>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-2">
            <div class="@cardClass">
                <div class="card-body">
                    <div class="h1 text-muted text-right mb-4">
                        <i class="icon-speedometer"></i>
                    </div>
                    <div class="text-value">@(Model.ImportDuration)</div>
                    <small class="text-muted text-uppercase font-weight-bold">Import duration</small>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-md-2">
            <div class="@cardClass">
                <div class="card-body">
                    <div class="h1 text-muted text-right mb-4">
                        <i class="fa fa-stamp"></i>
                    </div>
                    <div class="text-value small">@Model.NumberOfStamps</div>
                    <small class="text-muted text-uppercase font-weight-bold">Repository stamps</small>
                </div>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-md-12">
            <partial name="_RepoSearchPartial" for="@Model.SearchIndexViewModel" />
        </div>
    </div>


    <div id="searchResults">
        
        <div class="mb-2 table-header">
            <h2 style="display: inline;">
                Projects list
            </h2>
        </div>
        <partial name="_ProjectsTablePartial" model="@Model.ProjectsTable"/>
    </div>

}

<span id="RepositoryInfo" style="display: none; color: #73818f;">
    <span class="small">
        <span class="font-weight-bold">Current Stamp:&nbsp;</span>
        <span class="">@Model.RepositoryStamp</span>
    </span>
    <span class="small">
        <span class="font-weight-bold">Repository mode:&nbsp;</span>
        <span class="">@Model.RepositoryMode</span>
    </span>
</span>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $('#LeftBreadcrumbsMenu').append($('#RepositoryInfo'));
            $('#RepositoryInfo').show();
        });

        $(document).ready(function () {

            $('#searchQuery').keypress(function (e) {
                var key = e.which;
                if(key === 13)  // the enter key code
                {
                    $('#searchBtn').click();
                    return false;
                }
            });
            //RegexColorizer.addStyleSheet();
            RegexColorizer.colorizeAll();

            $("#searchBtn").click(function () {
                var overlay = $(this).closest('.card').find('.overlay');
                $(overlay).fadeIn();

                var queryString ='&query=' + encodeURIComponent($('#searchQuery').val()) + '&isRegex=' + $('#isRegex').is(':checked');
                var url = '@Url.Action("Search","Search")';
                var reposParam= "'&org=@Model.OrganizationName&repo=@Model.RepositoryName";

                var fullQuery = reposParam + queryString + getAllActiveFiltersQuery();
                fullQuery = '?' + fullQuery.replace(/^&/, '');

                url = url + fullQuery;
                $.get(url,
                    function (data) {
                        $(overlay).fadeOut();
                        $('#searchResults').fadeIn();
                        $("#searchResults").html(data);
                        RegexColorizer.colorizeAll();

                    });
                var historyUrl = '@Url.Action("GetSearchResultPage", "Search")';
                historyUrl = historyUrl + fullQuery;
                history.pushState(null, null, historyUrl);
            });
        });
    </script>

}


