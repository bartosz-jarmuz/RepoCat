"use strict";window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],r="zero-timeout-message";return window.addEventListener("message",function(t){if("string"==typeof t.data&&t.data.substr(0,r.length)===r){t.stopImmediatePropagation();var e=parseInt(t.data.substr(r.length),36);a[e]&&(a[e](),a[e]=void 0)}},!0),window.clearImmediate=function(t){a[t]&&(a[t]=void 0)},function(t){var e=a.length;return a.push(t),window.postMessage(r+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),function(t){function L(t){for(var e,a,r=t.length;r;e=Math.floor(Math.random()*r),a=t[--r],t[r]=t[e],t[e]=a);return t}function e(M,t){if(s){Array.isArray(M)||(M=[M]),M.forEach(function(t,e){if("string"==typeof t){if(M[e]=document.getElementById(t),!M[e])throw"The element id specified is not found."}else if(!t.tagName&&!t.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var S={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var e in t)e in S&&(S[e]=t[e]);if("function"!=typeof S.weightFactor){var a=S.weightFactor;S.weightFactor=function(t){return t*a}}if("function"!=typeof S.shape)switch(S.shape){case"circle":default:S.shape="circle";break;case"cardioid":S.shape=function(t){return 1-Math.sin(t)};break;case"diamond":S.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"square":S.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":S.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":S.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":S.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":S.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}S.gridSize=Math.max(Math.floor(S.gridSize),4);var w,g,v,p,x,b,T,E,F=S.gridSize,o=F-S.maskGapWidth,c=Math.abs(S.maxRotation-S.minRotation),h=Math.abs(Math.floor(S.rotationSteps)),u=Math.min(S.maxRotation,S.minRotation);switch(S.color){case"random-dark":T=function(){return i(10,50)};break;case"random-light":T=function(){return i(50,90)};break;default:"function"==typeof S.color&&(T=S.color)}"function"==typeof S.fontWeight&&(E=S.fontWeight);var I=null;"function"==typeof S.classes&&(I=S.classes);var k,y=!1,C=[],r=function(t){var e,a,r=t.currentTarget,i=r.getBoundingClientRect();a=t.touches?(e=t.touches[0].clientX,t.touches[0].clientY):(e=t.clientX,t.clientY);var o=e-i.left,n=a-i.top,s=Math.floor(o*(r.width/i.width||1)/F),l=Math.floor(n*(r.height/i.height||1)/F);return C[s][l]},P=function(t){var e=r(t);k!==e&&((k=e)?S.hover(e.item,e.dimension,t):S.hover(void 0,void 0,t))},R=function(t){var e=r(t);e&&(S.click(e.item,e.dimension,t),t.preventDefault())},n=[],m=function(t){if(n[t])return n[t];var e=8*t,a=e,r=[];for(0===t&&r.push([p[0],p[1],0]);a--;){var i=1;"circle"!==S.shape&&(i=S.shape(a/e*2*Math.PI)),r.push([p[0]+t*i*Math.cos(-a/e*2*Math.PI),p[1]+t*i*Math.sin(-a/e*2*Math.PI)*S.ellipticity,a/e*2*Math.PI])}return n[t]=r},O=function(){return 0<S.abortThreshold&&(new Date).getTime()-b>S.abortThreshold},z=function(t,e,a,r,i){if(!(g<=t||v<=e||t<0||e<0)){if(w[t][e]=!1,a)M[0].getContext("2d").fillRect(t*F,e*F,o,o);y&&(C[t][e]={item:i,dimension:r})}},A=function t(r){var i,o,n;Array.isArray(r)?(i=r[0],o=r[1]):(i=r.word,o=r.weight,n=r.attributes);var s=0===S.rotateRatio?0:Math.random()>S.rotateRatio?0:0===c?u:0<h?u+Math.floor(Math.random()*h)*c/(h-1):u+Math.random()*c,l=function(t,e,a){var r=S.weightFactor(e);if(r<=S.minSize)return!1;var i,o=1;r<D&&(o=function(){for(var t=2;t*r<D;)t+=2;return t}()),i=E?E(t,e,r):S.fontWeight;var n=document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});s.font=i+" "+(r*o).toString(10)+"px "+S.fontFamily;var l=s.measureText(t).width/o,f=Math.max(r*o,s.measureText("m").width,s.measureText("Ｗ").width)/o,d=l+2*f,c=3*f,h=Math.ceil(d/F),u=Math.ceil(c/F);d=h*F,c=u*F;var m=-l/2,w=.4*-f,g=Math.ceil((d*Math.abs(Math.sin(a))+c*Math.abs(Math.cos(a)))/F),v=Math.ceil((d*Math.abs(Math.cos(a))+c*Math.abs(Math.sin(a)))/F),M=v*F,p=g*F;n.setAttribute("width",M),n.setAttribute("height",p),s.scale(1/o,1/o),s.translate(M*o/2,p*o/2),s.rotate(-a),s.font=i+" "+(r*o).toString(10)+"px "+S.fontFamily,s.fillStyle="#000",s.textBaseline="middle",s.fillText(t,m*o,(w+.5*r)*o);var x=s.getImageData(0,0,M,p).data;if(O())return!1;for(var b,T,I,k=[],y=v,C=[g/2,v/2,g/2,v/2];y--;)for(b=g;b--;){I=F;t:{for(;I--;)for(T=F;T--;)if(x[4*((b*F+I)*M+(y*F+T))+3]){k.push([y,b]),y<C[3]&&(C[3]=y),y>C[1]&&(C[1]=y),b<C[0]&&(C[0]=b),b>C[2]&&(C[2]=b);break t}0}}return{mu:o,occupied:k,bounds:C,gw:v,gh:g,fillTextOffsetX:m,fillTextOffsetY:w,fillTextWidth:l,fillTextHeight:f,fontSize:r}}(i,o,s);if(!l)return!1;if(O())return!1;if(!S.drawOutOfBound){var e=l.bounds;if(e[1]-e[3]+1>g||e[2]-e[0]+1>v)return!1}for(var f=x+1,a=function(t){var e=Math.floor(t[0]-l.gw/2),a=Math.floor(t[1]-l.gh/2);l.gw,l.gh;return!!function(t,e,a,r,i){for(var o=i.length;o--;){var n=t+i[o][0],s=e+i[o][1];if(g<=n||v<=s||n<0||s<0){if(!S.drawOutOfBound)return!1}else if(!w[n][s])return!1}return!0}(e,a,0,0,l.occupied)&&(function(l,f,d,c,t,e,a,h,u){var m,w,g,v=d.fontSize;m=T?T(c,t,v,e,a):S.color,w=E?E(c,t,v):S.fontWeight,g=I?I(c,t,v):S.classes;var r=d.bounds;r[3],r[0],r[1],r[3],r[2],r[0],M.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),a=d.mu;e.save(),e.scale(1/a,1/a),e.font=w+" "+(v*a).toString(10)+"px "+S.fontFamily,e.fillStyle=m,e.translate((l+d.gw/2)*F*a,(f+d.gh/2)*F*a),0!==h&&e.rotate(-h),e.textBaseline="middle",e.fillText(c,d.fillTextOffsetX*a,(d.fillTextOffsetY+.5*v)*a),e.restore()}else{var r=document.createElement("span"),i="";i="rotate("+-h/Math.PI*180+"deg) ",1!==d.mu&&(i+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var o={position:"absolute",display:"block",font:w+" "+v*d.mu+"px "+S.fontFamily,left:(l+d.gw/2)*F+d.fillTextOffsetX+"px",top:(f+d.gh/2)*F+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",lineHeight:v+"px",whiteSpace:"nowrap",transform:i,webkitTransform:i,msTransform:i,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(var n in m&&(o.color=m),r.textContent=c,o)r.style[n]=o[n];if(u)for(var s in u)r.setAttribute(s,u[s]);g&&(r.className+=g),t.appendChild(r)}})}(e,a,l,i,o,x-f,t[2],s,n),function(t,e,a,r,i,o){var n,s,l=i.occupied,f=S.drawMask;if(f&&((n=M[0].getContext("2d")).save(),n.fillStyle=S.maskColor),y){var d=i.bounds;s={x:(t+d[3])*F,y:(e+d[0])*F,w:(d[1]-d[3]+1)*F,h:(d[2]-d[0]+1)*F}}for(var c=l.length;c--;){var h=t+l[c][0],u=e+l[c][1];g<=h||v<=u||h<0||u<0||z(h,u,f,s,o)}f&&n.restore()}(e,a,0,0,l,r),!0)};f--;){var d=m(x-f);if(S.shuffle&&(d=[].concat(d),L(d)),d.some(a))return!0}return!!S.shrinkToFit&&(Array.isArray(r)?r[1]=3*r[1]/4:r.weight=3*r.weight/4,t(r))},W=function(a,t,r){if(t)return!M.some(function(t){var e=new CustomEvent(a,{detail:r||{}});return!t.dispatchEvent(e)},this);M.forEach(function(t){var e=new CustomEvent(a,{detail:r||{}});t.dispatchEvent(e)},this)};!function(){var e=M[0];if(e.getContext)g=Math.ceil(e.width/F),v=Math.ceil(e.height/F);else{var t=e.getBoundingClientRect();g=Math.ceil(t.width/F),v=Math.ceil(t.height/F)}if(W("wordcloudstart",!0)){var a,r,i,o,n;if(p=S.origin?[S.origin[0]/F,S.origin[1]/F]:[g/2,v/2],x=Math.floor(Math.sqrt(g*g+v*v)),w=[],!e.getContext||S.clearCanvas)for(M.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=S.backgroundColor,e.clearRect(0,0,g*(F+1),v*(F+1)),e.fillRect(0,0,g*(F+1),v*(F+1))}else t.textContent="",t.style.backgroundColor=S.backgroundColor,t.style.position="relative"}),a=g;a--;)for(w[a]=[],r=v;r--;)w[a][r]=!0;else{var s=document.createElement("canvas").getContext("2d");s.fillStyle=S.backgroundColor,s.fillRect(0,0,1,1);var l,f,d=s.getImageData(0,0,1,1).data,c=e.getContext("2d").getImageData(0,0,g*F,v*F).data;for(a=g;a--;)for(w[a]=[],r=v;r--;){f=F;t:for(;f--;)for(l=F;l--;)for(i=4;i--;)if(c[4*((r*F+f)*g*F+(a*F+l))+i]!==d[i]){w[a][r]=!1;break t}!1!==w[a][r]&&(w[a][r]=!0)}c=s=d=void 0}if(S.hover||S.click){for(y=!0,a=g+1;a--;)C[a]=[];S.hover&&e.addEventListener("mousemove",P),S.click&&(e.addEventListener("click",R),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",P),e.removeEventListener("click",R),k=void 0})}n=(i=0)!==S.wait?(o=window.setTimeout,window.clearTimeout):(o=window.setImmediate,window.clearImmediate);var h=function(e,a){M.forEach(function(t){t.removeEventListener(e,a)},this)},u=function t(){h("wordcloudstart",t),n(m)};!function(e,a){M.forEach(function(t){t.addEventListener(e,a)},this)}("wordcloudstart",u);var m=o(function t(){if(i>=S.list.length)return n(m),W("wordcloudstop",!1),void h("wordcloudstart",u);b=(new Date).getTime();var e=A(S.list[i]),a=!W("wordclouddrawn",!0,{item:S.list[i],drawn:e});if(O()||a)return n(m),S.abort(),W("wordcloudabort",!1),W("wordcloudstop",!1),void h("wordcloudstart",u);i++,m=o(t,S.wait)},S.wait)}}()}function i(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}}var s=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e&&(!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),D=function(){if(s){for(var t,e,a=document.createElement("canvas").getContext("2d"),r=20;r;){if(a.font=r.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===e)return r+1;t=a.measureText("Ｗ").width,e=a.measureText("m").width,r--}return 0}}();e.isSupported=s,e.minFontSize=D,"function"==typeof define&&define.amd?(t.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:t.WordCloud=e}(this);